<?xml version="1.0" encoding="UTF-8"?>
<testsuite xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="https://maven.apache.org/surefire/maven-surefire-plugin/xsd/surefire-test-report-3.0.xsd" version="3.0" name="jakartamission.udbl.jakartamission.business.UtilisateurEntrepriseBeanTest" time="0.068" tests="5" errors="0" skipped="0" failures="0">
  <properties>
    <property name="netbeans.deploy" value="true"/>
    <property name="java.specification.version" value="17"/>
    <property name="sun.cpu.isalist" value="amd64"/>
    <property name="sun.jnu.encoding" value="Cp1252"/>
    <property name="java.class.path" value="C:\Users\HP\Documents\NetBeansProjects\jakartamission\target\test-classes;C:\Users\HP\Documents\NetBeansProjects\jakartamission\target\classes;C:\Users\HP\.m2\repository\jakarta\platform\jakarta.jakartaee-api\10.0.0\jakarta.jakartaee-api-10.0.0.jar;C:\Users\HP\.m2\repository\jakarta\platform\jakarta.jakartaee-web-api\10.0.0\jakarta.jakartaee-web-api-10.0.0.jar;C:\Users\HP\.m2\repository\jakarta\servlet\jakarta.servlet-api\6.0.0\jakarta.servlet-api-6.0.0.jar;C:\Users\HP\.m2\repository\jakarta\servlet\jsp\jakarta.servlet.jsp-api\3.1.0\jakarta.servlet.jsp-api-3.1.0.jar;C:\Users\HP\.m2\repository\jakarta\el\jakarta.el-api\5.0.1\jakarta.el-api-5.0.1.jar;C:\Users\HP\.m2\repository\jakarta\servlet\jsp\jstl\jakarta.servlet.jsp.jstl-api\3.0.0\jakarta.servlet.jsp.jstl-api-3.0.0.jar;C:\Users\HP\.m2\repository\jakarta\faces\jakarta.faces-api\4.0.1\jakarta.faces-api-4.0.1.jar;C:\Users\HP\.m2\repository\jakarta\ws\rs\jakarta.ws.rs-api\3.1.0\jakarta.ws.rs-api-3.1.0.jar;C:\Users\HP\.m2\repository\jakarta\websocket\jakarta.websocket-api\2.1.0\jakarta.websocket-api-2.1.0.jar;C:\Users\HP\.m2\repository\jakarta\websocket\jakarta.websocket-client-api\2.1.0\jakarta.websocket-client-api-2.1.0.jar;C:\Users\HP\.m2\repository\jakarta\json\jakarta.json-api\2.1.0\jakarta.json-api-2.1.0.jar;C:\Users\HP\.m2\repository\jakarta\json\bind\jakarta.json.bind-api\3.0.0\jakarta.json.bind-api-3.0.0.jar;C:\Users\HP\.m2\repository\jakarta\annotation\jakarta.annotation-api\2.1.1\jakarta.annotation-api-2.1.1.jar;C:\Users\HP\.m2\repository\jakarta\ejb\jakarta.ejb-api\4.0.1\jakarta.ejb-api-4.0.1.jar;C:\Users\HP\.m2\repository\jakarta\transaction\jakarta.transaction-api\2.0.1\jakarta.transaction-api-2.0.1.jar;C:\Users\HP\.m2\repository\jakarta\persistence\jakarta.persistence-api\3.1.0\jakarta.persistence-api-3.1.0.jar;C:\Users\HP\.m2\repository\jakarta\validation\jakarta.validation-api\3.0.2\jakarta.validation-api-3.0.2.jar;C:\Users\HP\.m2\repository\jakarta\interceptor\jakarta.interceptor-api\2.1.0\jakarta.interceptor-api-2.1.0.jar;C:\Users\HP\.m2\repository\jakarta\enterprise\jakarta.enterprise.cdi-api\4.0.1\jakarta.enterprise.cdi-api-4.0.1.jar;C:\Users\HP\.m2\repository\jakarta\enterprise\jakarta.enterprise.lang-model\4.0.1\jakarta.enterprise.lang-model-4.0.1.jar;C:\Users\HP\.m2\repository\jakarta\inject\jakarta.inject-api\2.0.1\jakarta.inject-api-2.0.1.jar;C:\Users\HP\.m2\repository\jakarta\authentication\jakarta.authentication-api\3.0.0\jakarta.authentication-api-3.0.0.jar;C:\Users\HP\.m2\repository\jakarta\security\enterprise\jakarta.security.enterprise-api\3.0.0\jakarta.security.enterprise-api-3.0.0.jar;C:\Users\HP\.m2\repository\jakarta\jms\jakarta.jms-api\3.1.0\jakarta.jms-api-3.1.0.jar;C:\Users\HP\.m2\repository\jakarta\activation\jakarta.activation-api\2.1.0\jakarta.activation-api-2.1.0.jar;C:\Users\HP\.m2\repository\jakarta\mail\jakarta.mail-api\2.1.0\jakarta.mail-api-2.1.0.jar;C:\Users\HP\.m2\repository\jakarta\resource\jakarta.resource-api\2.1.0\jakarta.resource-api-2.1.0.jar;C:\Users\HP\.m2\repository\jakarta\authorization\jakarta.authorization-api\2.1.0\jakarta.authorization-api-2.1.0.jar;C:\Users\HP\.m2\repository\jakarta\batch\jakarta.batch-api\2.1.1\jakarta.batch-api-2.1.1.jar;C:\Users\HP\.m2\repository\org\mindrot\jbcrypt\0.4\jbcrypt-0.4.jar;C:\Users\HP\.m2\repository\org\junit\jupiter\junit-jupiter-api\5.9.3\junit-jupiter-api-5.9.3.jar;C:\Users\HP\.m2\repository\org\opentest4j\opentest4j\1.2.0\opentest4j-1.2.0.jar;C:\Users\HP\.m2\repository\org\junit\platform\junit-platform-commons\1.9.3\junit-platform-commons-1.9.3.jar;C:\Users\HP\.m2\repository\org\apiguardian\apiguardian-api\1.1.2\apiguardian-api-1.1.2.jar;C:\Users\HP\.m2\repository\org\junit\jupiter\junit-jupiter-engine\5.9.3\junit-jupiter-engine-5.9.3.jar;C:\Users\HP\.m2\repository\org\junit\platform\junit-platform-engine\1.9.3\junit-platform-engine-1.9.3.jar;"/>
    <property name="java.vm.vendor" value="Oracle Corporation"/>
    <property name="sun.arch.data.model" value="64"/>
    <property name="user.variant" value=""/>
    <property name="exec.appArgs" value=""/>
    <property name="java.vendor.url" value="https://java.oracle.com/"/>
    <property name="user.timezone" value="Africa/Johannesburg"/>
    <property name="os.name" value="Windows 11"/>
    <property name="java.vm.specification.version" value="17"/>
    <property name="user.country" value="FR"/>
    <property name="sun.java.launcher" value="SUN_STANDARD"/>
    <property name="sun.boot.library.path" value="C:\Program Files\Java\jdk-17\bin"/>
    <property name="sun.java.command" value="C:\Users\HP\AppData\Local\Temp\surefire9571883992427522703\surefirebooter-20251219154645498_3.jar C:\Users\HP\AppData\Local\Temp\surefire9571883992427522703 2025-12-19T15-46-45_329-jvmRun1 surefire-20251219154645498_1tmp surefire_0-20251219154645498_2tmp"/>
    <property name="jdk.debug" value="release"/>
    <property name="exec.vmArgs" value=""/>
    <property name="surefire.test.class.path" value="C:\Users\HP\Documents\NetBeansProjects\jakartamission\target\test-classes;C:\Users\HP\Documents\NetBeansProjects\jakartamission\target\classes;C:\Users\HP\.m2\repository\jakarta\platform\jakarta.jakartaee-api\10.0.0\jakarta.jakartaee-api-10.0.0.jar;C:\Users\HP\.m2\repository\jakarta\platform\jakarta.jakartaee-web-api\10.0.0\jakarta.jakartaee-web-api-10.0.0.jar;C:\Users\HP\.m2\repository\jakarta\servlet\jakarta.servlet-api\6.0.0\jakarta.servlet-api-6.0.0.jar;C:\Users\HP\.m2\repository\jakarta\servlet\jsp\jakarta.servlet.jsp-api\3.1.0\jakarta.servlet.jsp-api-3.1.0.jar;C:\Users\HP\.m2\repository\jakarta\el\jakarta.el-api\5.0.1\jakarta.el-api-5.0.1.jar;C:\Users\HP\.m2\repository\jakarta\servlet\jsp\jstl\jakarta.servlet.jsp.jstl-api\3.0.0\jakarta.servlet.jsp.jstl-api-3.0.0.jar;C:\Users\HP\.m2\repository\jakarta\faces\jakarta.faces-api\4.0.1\jakarta.faces-api-4.0.1.jar;C:\Users\HP\.m2\repository\jakarta\ws\rs\jakarta.ws.rs-api\3.1.0\jakarta.ws.rs-api-3.1.0.jar;C:\Users\HP\.m2\repository\jakarta\websocket\jakarta.websocket-api\2.1.0\jakarta.websocket-api-2.1.0.jar;C:\Users\HP\.m2\repository\jakarta\websocket\jakarta.websocket-client-api\2.1.0\jakarta.websocket-client-api-2.1.0.jar;C:\Users\HP\.m2\repository\jakarta\json\jakarta.json-api\2.1.0\jakarta.json-api-2.1.0.jar;C:\Users\HP\.m2\repository\jakarta\json\bind\jakarta.json.bind-api\3.0.0\jakarta.json.bind-api-3.0.0.jar;C:\Users\HP\.m2\repository\jakarta\annotation\jakarta.annotation-api\2.1.1\jakarta.annotation-api-2.1.1.jar;C:\Users\HP\.m2\repository\jakarta\ejb\jakarta.ejb-api\4.0.1\jakarta.ejb-api-4.0.1.jar;C:\Users\HP\.m2\repository\jakarta\transaction\jakarta.transaction-api\2.0.1\jakarta.transaction-api-2.0.1.jar;C:\Users\HP\.m2\repository\jakarta\persistence\jakarta.persistence-api\3.1.0\jakarta.persistence-api-3.1.0.jar;C:\Users\HP\.m2\repository\jakarta\validation\jakarta.validation-api\3.0.2\jakarta.validation-api-3.0.2.jar;C:\Users\HP\.m2\repository\jakarta\interceptor\jakarta.interceptor-api\2.1.0\jakarta.interceptor-api-2.1.0.jar;C:\Users\HP\.m2\repository\jakarta\enterprise\jakarta.enterprise.cdi-api\4.0.1\jakarta.enterprise.cdi-api-4.0.1.jar;C:\Users\HP\.m2\repository\jakarta\enterprise\jakarta.enterprise.lang-model\4.0.1\jakarta.enterprise.lang-model-4.0.1.jar;C:\Users\HP\.m2\repository\jakarta\inject\jakarta.inject-api\2.0.1\jakarta.inject-api-2.0.1.jar;C:\Users\HP\.m2\repository\jakarta\authentication\jakarta.authentication-api\3.0.0\jakarta.authentication-api-3.0.0.jar;C:\Users\HP\.m2\repository\jakarta\security\enterprise\jakarta.security.enterprise-api\3.0.0\jakarta.security.enterprise-api-3.0.0.jar;C:\Users\HP\.m2\repository\jakarta\jms\jakarta.jms-api\3.1.0\jakarta.jms-api-3.1.0.jar;C:\Users\HP\.m2\repository\jakarta\activation\jakarta.activation-api\2.1.0\jakarta.activation-api-2.1.0.jar;C:\Users\HP\.m2\repository\jakarta\mail\jakarta.mail-api\2.1.0\jakarta.mail-api-2.1.0.jar;C:\Users\HP\.m2\repository\jakarta\resource\jakarta.resource-api\2.1.0\jakarta.resource-api-2.1.0.jar;C:\Users\HP\.m2\repository\jakarta\authorization\jakarta.authorization-api\2.1.0\jakarta.authorization-api-2.1.0.jar;C:\Users\HP\.m2\repository\jakarta\batch\jakarta.batch-api\2.1.1\jakarta.batch-api-2.1.1.jar;C:\Users\HP\.m2\repository\org\mindrot\jbcrypt\0.4\jbcrypt-0.4.jar;C:\Users\HP\.m2\repository\org\junit\jupiter\junit-jupiter-api\5.9.3\junit-jupiter-api-5.9.3.jar;C:\Users\HP\.m2\repository\org\opentest4j\opentest4j\1.2.0\opentest4j-1.2.0.jar;C:\Users\HP\.m2\repository\org\junit\platform\junit-platform-commons\1.9.3\junit-platform-commons-1.9.3.jar;C:\Users\HP\.m2\repository\org\apiguardian\apiguardian-api\1.1.2\apiguardian-api-1.1.2.jar;C:\Users\HP\.m2\repository\org\junit\jupiter\junit-jupiter-engine\5.9.3\junit-jupiter-engine-5.9.3.jar;C:\Users\HP\.m2\repository\org\junit\platform\junit-platform-engine\1.9.3\junit-platform-engine-1.9.3.jar;"/>
    <property name="sun.cpu.endian" value="little"/>
    <property name="user.home" value="C:\Users\HP"/>
    <property name="user.language" value="fr"/>
    <property name="java.specification.vendor" value="Oracle Corporation"/>
    <property name="java.version.date" value="2024-04-16"/>
    <property name="java.home" value="C:\Program Files\Java\jdk-17"/>
    <property name="file.separator" value="\"/>
    <property name="basedir" value="C:\Users\HP\Documents\NetBeansProjects\jakartamission"/>
    <property name="java.vm.compressedOopsMode" value="Zero based"/>
    <property name="line.separator" value="&#10;"/>
    <property name="java.vm.specification.vendor" value="Oracle Corporation"/>
    <property name="java.specification.name" value="Java Platform API Specification"/>
    <property name="surefire.real.class.path" value="C:\Users\HP\AppData\Local\Temp\surefire9571883992427522703\surefirebooter-20251219154645498_3.jar"/>
    <property name="user.script" value=""/>
    <property name="sun.management.compiler" value="HotSpot 64-Bit Tiered Compilers"/>
    <property name="java.runtime.version" value="17.0.11+7-LTS-207"/>
    <property name="user.name" value="HP"/>
    <property name="path.separator" value=";"/>
    <property name="os.version" value="10.0"/>
    <property name="java.runtime.name" value="Java(TM) SE Runtime Environment"/>
    <property name="file.encoding" value="UTF-8"/>
    <property name="java.vm.name" value="Java HotSpot(TM) 64-Bit Server VM"/>
    <property name="maven.ext.class.path" value="C:\netbeans-28-bin\netbeans\java\maven-nblib\netbeans-eventspy.jar"/>
    <property name="localRepository" value="C:\Users\HP\.m2\repository"/>
    <property name="java.vendor.url.bug" value="https://bugreport.java.com/bugreport/"/>
    <property name="java.io.tmpdir" value="C:\Users\HP\AppData\Local\Temp\"/>
    <property name="java.version" value="17.0.11"/>
    <property name="user.dir" value="C:\Users\HP\Documents\NetBeansProjects\jakartamission"/>
    <property name="os.arch" value="amd64"/>
    <property name="java.vm.specification.name" value="Java Virtual Machine Specification"/>
    <property name="sun.os.patch.level" value=""/>
    <property name="native.encoding" value="Cp1252"/>
    <property name="java.library.path" value="C:\Program Files\Java\jdk-17\bin;C:\Windows\Sun\Java\bin;C:\Windows\system32;C:\Windows;C:\Python313\Scripts\;C:\Python313\;C:\Windows\system32;C:\Windows;C:\Windows\System32\Wbem;C:\Windows\System32\WindowsPowerShell\v1.0\;C:\Windows\System32\OpenSSH\;C:\Program Files\nodejs\;C:\ProgramData\chocolatey\bin;C:\msys64\clang64\bin;C:\msys64\mingw64\bin;C:\msys64\ucrt64\bin;C:\msys64\clang64\bin;C:\Program Files\CMake\bin;C:\Qt\6.9.1\mingw_64\bin;C:\Program Files\VSCodium\bin;C:\Program Files\Git\cmd;c:\Users\HP\AppData\Local\Programs\cursor\resources\app\bin;C:\Users\HP\AppData\Local\Android\Sdk;C:\Users\HP\GlassFish_Server\bin;C:\zulu17.62.17-ca-jdk17.0.17-win_x64\zulu17.62.17-ca-jdk17.0.17-win_x64\bin;C:\php85;C:\php85;C:\php85;C:\Python313\Scripts\;C:\Python313\;C:\Windows\system32;C:\Windows;C:\Windows\System32\Wbem;C:\Windows\System32\WindowsPowerShell\v1.0\;C:\Windows\System32\OpenSSH\;C:\Program Files\nodejs\;C:\ProgramData\chocolatey\bin;C:\msys64\clang64\bin;C:\msys64\mingw64\bin;C:\msys64\ucrt64\bin;C:\msys64\clang64\bin;C:\Program Files\CMake\bin;C:\Qt\6.9.1\mingw_64\bin;C:\Program Files\VSCodium\bin;C:\Program Files\Git\cmd;c:\Users\HP\AppData\Local\Programs\cursor\resources\app\bin;C:\Users\HP\AppData\Local\Android\Sdk;C:\Users\HP\GlassFish_Server\bin;C:\Users\HP\AppData\Local\Android\Sdk\platform-tools;C:\Users\HP\AppData\Local\Android\Sdk\tools;C:\Users\HP\AppData\Local\Android\Sdk\tools\bin;C:\User;C:\zulu17.62.17-ca-jdk17.0.17-win_x64\zulu17.62.17-ca-jdk17.0.17-win_x64\bin;C:\Users\HP\AppData\Local\Programs\Microsoft VS Code\bin;."/>
    <property name="java.vm.info" value="mixed mode, sharing"/>
    <property name="java.vendor" value="Oracle Corporation"/>
    <property name="java.vm.version" value="17.0.11+7-LTS-207"/>
    <property name="sun.io.unicode.encoding" value="UnicodeLittle"/>
    <property name="java.class.version" value="61.0"/>
  </properties>
  <testcase name="testJustification_Erreur_Doublon" classname="jakartamission.udbl.jakartamission.business.UtilisateurEntrepriseBeanTest" time="0.028">
    <system-out><![CDATA[
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  JUSTIFICATION COMPLETE : ERREUR DE DOUBLON (USERNAME/EMAIL)   â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ðŸ“‹ DEFINITION DU PROBLEME
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Tentative d'enregistrement d'un nouvel utilisateur avec :
  â€¢ Un username dÃ©jÃ  existant
  â€¢ Ou une adresse email dÃ©jÃ  existante
  â€¢ Ou les deux

â›” ERREUR AFFICHEE
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
FacesMessage(SEVERITY_ERROR):
  'Ce nom d'utilisateur et cette adresse existent dÃ©jÃ '

ðŸ” ARCHITECTURE DE VALIDATION
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

â”Œâ”€ NIVEAU 1 : PRESENTATION (JSF/Managed Bean)
â”‚  â”œâ”€ Classe : UtilisateurBean
â”‚  â”œâ”€ MÃ©thode : ajouterUtilisateur()
â”‚  â”œâ”€ VÃ©rifications :
â”‚  â”‚   âœ“ password.equals(confirmPassword)
â”‚  â”‚   âœ“ utilisateurEntrepriseBean.usernameExiste(username)
â”‚  â”‚   âœ“ utilisateurEntrepriseBean.emailExiste(email)
â”‚  â””â”€ RÃ©sultat : FacesMessage avec message d'erreur

â”Œâ”€ NIVEAU 2 : METIER (Business Logic)
â”‚  â”œâ”€ Classe : UtilisateurEntrepriseBean
â”‚  â”œâ”€ MÃ©thodes :
â”‚  â”‚   âœ“ usernameExiste(String username)
â”‚  â”‚   âœ“ emailExiste(String email)
â”‚  â”œâ”€ RequÃªtes JPQL :
â”‚  â”‚   SELECT u FROM User u WHERE u.username = :username
â”‚  â”‚   SELECT u FROM User u WHERE u.email = :email
â”‚  â”œâ”€ Annotation : @Transactional
â”‚  â””â”€ RÃ©sultat : null si existe, User si new

â”Œâ”€ NIVEAU 3 : PERSISTANCE (Database)
â”‚  â”œâ”€ Classe EntitÃ© : User.java
â”‚  â”œâ”€ Contraintes : @Column(unique = true)
â”‚  â”‚   @Column(unique = true, nullable = false, length = 50)
â”‚  â”‚   private String username;
â”‚  â”‚
â”‚  â”‚   @Column(unique = true, nullable = false, length = 100)
â”‚  â”‚   private String email;
â”‚  â”‚
â”‚  â”œâ”€ Index crÃ©Ã©s en BD :
â”‚  â”‚   CREATE UNIQUE INDEX idx_username ON utilisateur(username);
â”‚  â”‚   CREATE UNIQUE INDEX idx_email ON utilisateur(email);
â”‚  â””â”€ Exception si violation : IntegrityConstraintViolationException

âœ… FLUX D'EXECUTION
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
User Input (2 cas):
  â”‚
  â”œâ”€ CAS 1: DonnÃ©es valides et uniques
  â”‚         â†“
  â”‚   âœ“ Passe la validation front-end
  â”‚   âœ“ Passe la validation mÃ©tier
  â”‚   âœ“ Enregistrement en BD
  â”‚   âœ“ Message : 'Utilisateur ajoutÃ© avec succÃ¨s'
  â”‚
  â””â”€ CAS 2: Username ou Email dÃ©jÃ  existant
           â†“
       âœ— Validation front-end Ã©choue
       âœ— Message : 'Ce nom d'utilisateur et cette adresse existent dÃ©jÃ '
       âœ— Aucune requÃªte BD envoyÃ©e
       âœ— Les champs restent remplis pour correction

ðŸ›¡ï¸  DEFENSE IN DEPTH (SÃ©curitÃ© en profondeur)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
MÃªme si quelqu'un contourne le front-end :
  1. Envoi direct au serveur (API hack)
  2. Bypass de UtilisateurBean
  3. La BD bloque quand mÃªme
  4. SQLException levÃ©e
  5. DonnÃ©es restent cohÃ©rentes

ðŸ“Š TABLE UTILISATEUR
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ID | Username    | Email           | Password (hash)
â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1  | john_doe    | john@mail.com   | $2a$10$...
2  | jane_smith  | jane@mail.com   | $2a$10$...
   | [UNIQUE KEY sur username, email]
   | Tentative insertion : john_doe (doublon)
   | âŒ ERREUR : Violation de contrainte UNIQUE

âœ¨ RESUMÃ‰
â”€â”€â”€â”€â”€â”€â”€â”€
âœ“ Architecture robuste avec 3 niveaux de validation
âœ“ Message clair pour l'utilisateur
âœ“ Protection garantie mÃªme si hackÃ©e au front
âœ“ Performance optimale (validations rapides)
âœ“ IntÃ©gritÃ© des donnÃ©es assurÃ©e
]]></system-out>
  </testcase>
  <testcase name="testUsernameExiste_UtilisateurInexistant" classname="jakartamission.udbl.jakartamission.business.UtilisateurEntrepriseBeanTest" time="0.007"/>
  <testcase name="testAjouter_EmailDuplique_DoitEchouer" classname="jakartamission.udbl.jakartamission.business.UtilisateurEntrepriseBeanTest" time="0.003">
    <system-out><![CDATA[
=== TEST : Ajouter un utilisateur avec EMAIL DUPLIQUE ===
Ã‰tape 1 : CrÃ©ation du premier utilisateur
  - Username : john_doe
  - Email : john@mail.com
  âœ“ VÃ©rification : l'email n'existe pas en base

Ã‰tape 2 : Tentative de crÃ©ation d'un 2e utilisateur avec le mÃªme email
  - Username : jane_doe (DIFFERENT)
  - Email : john@mail.com (IDENTIQUE) âŒ

Ã‰tape 3 : VÃ©rification avant insertion
  Appel de : emailExiste('john@mail.com')
  RÃ©sultat : false (car pas encore en base dans ce test unitaire)

âœ“ JUSTIFICATION DE L'ERREUR :
  1. Contrainte UNIQUE(@Column(unique = true))
     - La colonne email est dÃ©finie avec unique = true
     - CrÃ©e un index UNIQUE en base de donnÃ©es

  2. Validation en 2 niveaux :
     a) FRONT-END (UtilisateurBean) :
        if (utilisateurEntrepriseBean.emailExiste(email)) {
            // Affiche : 'Ce nom d'utilisateur et cette adresse existent dÃ©jÃ '
        }

     b) BACK-END (Base de donnÃ©es) :
        - MÃªme si la vÃ©rification front-end est contournÃ©e
        - La BD vÃ©rifie la contrainte UNIQUE
        - LÃ¨ve une SQLException

  3. Protection en profondeur :
     - ValidationException (si validation JSR-303)
     - EntityExistsException (si duplicate key)
     - ConstraintViolationException (si contrainte BD)
]]></system-out>
  </testcase>
  <testcase name="testEmailExiste_EmailInexistant" classname="jakartamission.udbl.jakartamission.business.UtilisateurEntrepriseBeanTest" time="0.002"/>
  <testcase name="testAjouter_UsernameDuplique_DoitEchouer" classname="jakartamission.udbl.jakartamission.business.UtilisateurEntrepriseBeanTest" time="0.002">
    <system-out><![CDATA[
=== TEST : Ajouter un utilisateur avec USERNAME DUPLIQUE ===
Ã‰tape 1 : CrÃ©ation du premier utilisateur
  - Username : john_doe
  - Email : john@mail.com

Ã‰tape 2 : Tentative de crÃ©ation d'un 2e utilisateur avec le mÃªme username
  - Username : john_doe (IDENTIQUE) âŒ
  - Email : jane@mail.com (DIFFERENT)

âœ“ JUSTIFICATION DE L'ERREUR :
  1. Contrainte UNIQUE(@Column(unique = true))
     - La colonne username est dÃ©finie avec unique = true
     - CrÃ©e un index UNIQUE en base de donnÃ©es

  2. Validation au niveau UtilisateurBean :
     if (utilisateurEntrepriseBean.usernameExiste(username)) {
         context.addMessage(null, new FacesMessage(
             FacesMessage.SEVERITY_ERROR,
             'Ce nom d'utilisateur et cette adresse existent dÃ©jÃ ',
             null));
         return; // ArrÃªte l'insertion
     }

  3. Protection de la base de donnÃ©es :
     - Si le contrÃ´le front-end est contournÃ© (ex: appel direct API)
     - La BD lÃ¨ve une IntegrityConstraintViolationException
     - EmpÃªche la duplication au niveau le plus bas
]]></system-out>
  </testcase>
</testsuite>